<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Ä°letiÅŸim MesajlarÄ± - Admin Panel</title>
    <link rel="stylesheet" href="../../css/admin.css">
    <link href="https://fonts.googleapis.com/css2?family=Source+Sans+Pro:wght@400;600;700&display=swap" rel="stylesheet">
</head>
<body class="dashboard">
    <!-- Sidebar -->
    <aside class="sidebar">
        <div class="sidebar-header">
            <div class="sidebar-logo">GB</div>
            <h2>GenÃ§ Birey</h2>
        </div>

        <nav class="sidebar-menu">
            <div class="menu-section">
                <div class="menu-section-title">Ana MenÃ¼</div>
                <a href="admin_dashboard.html" class="menu-item">
                    <i>ğŸ“Š</i> <span>Dashboard</span>
                </a>
                <a href="#" class="menu-item">
                    <i>ğŸ“„</i> <span>Sayfalar</span>
                </a>
                <a href="YaziYonetimi.html" class="menu-item">
                    <i>ğŸ“</i> <span>Blog YazÄ±larÄ±</span>
                </a>
                <a href="#" class="menu-item">
                    <i>ğŸ–¼ï¸</i> <span>Projeler</span>
                </a>
                <a href="#" class="menu-item">
                    <i>âš™ï¸</i> <span>Hizmetler</span>
                </a>
            </div>

            <div class="menu-section">
                <div class="menu-section-title">Ä°Ã§erik YÃ¶netimi</div>
                <a href="#" class="menu-item">
                    <i>ğŸ¨</i> <span>Medya</span>
                </a>
                <a href="#" class="menu-item">
                    <i>ğŸ‘¥</i> <span>Ekip</span>
                </a>
                <a href="#" class="menu-item">
                    <i>ğŸ’¬</i> <span>Yorumlar</span>
                </a>
                <a href="IletisimMesajlari.html" class="menu-item active">
                    <i>ğŸ“§</i> <span>Mesajlar</span>
                </a>
            </div>

            <div class="menu-section">
                <div class="menu-section-title">Ayarlar</div>
                <a href="KategoriYonetimi.html" class="menu-item">
                    <i>ğŸ·ï¸</i> <span>Kategoriler</span>
                </a>
                <a href="#" class="menu-item">
                    <i>ğŸ‘¤</i> <span>KullanÄ±cÄ±lar</span>
                </a>
                <a href="#" class="menu-item">
                    <i>ğŸ”§</i> <span>Site AyarlarÄ±</span>
                </a>
                <a href="#" class="menu-item">
                    <i>ğŸ”</i> <span>GÃ¼venlik</span>
                </a>
                <a href="#" class="menu-item" onclick="logout()">
                    <i>ğŸšª</i> <span>Ã‡Ä±kÄ±ÅŸ Yap</span>
                </a>
            </div>
        </nav>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Topbar -->
        <div class="topbar">
            <div class="topbar-left">
                <h1>Ä°letiÅŸim MesajlarÄ±</h1>
                <p>Gelen mesajlarÄ± yÃ¶netin ve yanÄ±tlayÄ±n</p>
            </div>
            <div class="topbar-right">
                <div class="topbar-user">
                    <div class="user-avatar" id="userAvatar">A</div>
                    <div class="user-info">
                        <div class="user-name" id="userName">Admin User</div>
                        <div class="user-role" id="userRole">YÃ¶netici</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Message Stats -->
        <div class="message-stats">
            <div class="stat-card">
                <div class="stat-icon blue">ğŸ“§</div>
                <div class="stat-content">
                    <h3>24</h3>
                    <p>Toplam Mesaj</p>
                </div>
            </div>

            <div class="stat-card">
                <div class="stat-icon green">âœ…</div>
                <div class="stat-content">
                    <h3>18</h3>
                    <p>YanÄ±tlanmÄ±ÅŸ</p>
                </div>
            </div>

            <div class="stat-card">
                <div class="stat-icon orange">â³</div>
                <div class="stat-content">
                    <h3>6</h3>
                    <p>Bekleyen</p>
                </div>
            </div>

            <div class="stat-card">
                <div class="stat-icon red">ğŸ”¥</div>
                <div class="stat-content">
                    <h3>3</h3>
                    <p>Ã–ncelikli</p>
                </div>
            </div>
        </div>

        <!-- Filters and Actions -->
        <div class="content-filters">
            <div class="filter-group">
                <select id="statusFilter" class="filter-select">
                    <option value="">TÃ¼m Durumlar</option>
                    <option value="unread">OkunmamÄ±ÅŸ</option>
                    <option value="read">OkunmuÅŸ</option>
                    <option value="replied">YanÄ±tlanmÄ±ÅŸ</option>
                    <option value="priority">Ã–ncelikli</option>
                </select>
                
                <select id="typeFilter" class="filter-select">
                    <option value="">TÃ¼m Tipler</option>
                    <option value="general">Genel</option>
                    <option value="project">Proje</option>
                    <option value="service">Hizmet</option>
                    <option value="complaint">Åikayet</option>
                </select>

                <input type="text" id="searchInput" class="search-input" placeholder="GÃ¶nderen, konu veya iÃ§erik ara...">
            </div>

            <div class="action-buttons">
                <button class="btn btn-primary" onclick="markAllAsRead()">
                    <i>âœ…</i> TÃ¼mÃ¼nÃ¼ Okundu Ä°ÅŸaretle
                </button>
                <button class="btn btn-secondary" onclick="exportMessages()">
                    <i>ğŸ“¤</i> DÄ±ÅŸa Aktar
                </button>
            </div>
        </div>

        <!-- Messages List -->
        <div class="messages-container">
            <div class="messages-list">
                <!-- Message Item 1 -->
                <div class="message-item unread priority" data-id="1" onclick="openMessage(1)">
                    <div class="message-checkbox">
                        <input type="checkbox" class="message-check" data-id="1">
                    </div>
                    <div class="message-avatar">
                        <div class="avatar-circle">A</div>
                    </div>
                    <div class="message-content">
                        <div class="message-header">
                            <h4>Ahmet YÄ±lmaz</h4>
                            <span class="message-time">2 saat Ã¶nce</span>
                        </div>
                        <div class="message-subject">Proje Teklifi HakkÄ±nda</div>
                        <div class="message-preview">Merhaba, ofis binasÄ± projemiz iÃ§in teklif almak istiyoruz. DetaylarÄ± paylaÅŸabilir misiniz?</div>
                        <div class="message-meta">
                            <span class="message-type project">Proje</span>
                            <span class="message-priority">Ã–ncelikli</span>
                        </div>
                    </div>
                    <div class="message-actions">
                        <button class="btn-icon btn-reply" onclick="replyMessage(1)" title="YanÄ±tla">â†©ï¸</button>
                        <button class="btn-icon btn-delete" onclick="deleteMessage(1)" title="Sil">ğŸ—‘ï¸</button>
                    </div>
                </div>

                <!-- Message Item 2 -->
                <div class="message-item read" data-id="2" onclick="openMessage(2)">
                    <div class="message-checkbox">
                        <input type="checkbox" class="message-check" data-id="2">
                    </div>
                    <div class="message-avatar">
                        <div class="avatar-circle">Z</div>
                    </div>
                    <div class="message-content">
                        <div class="message-header">
                            <h4>Zeynep Åahin</h4>
                            <span class="message-time">1 gÃ¼n Ã¶nce</span>
                        </div>
                        <div class="message-subject">Blog YazÄ±sÄ± HakkÄ±nda Soru</div>
                        <div class="message-preview">YazÄ±nÄ±zÄ± okudum, Ã§ok faydalÄ±ydÄ±. Bu konuda daha detaylÄ± bilgi alabilir miyim?</div>
                        <div class="message-meta">
                            <span class="message-type general">Genel</span>
                            <span class="message-status replied">YanÄ±tlandÄ±</span>
                        </div>
                    </div>
                    <div class="message-actions">
                        <button class="btn-icon btn-reply" onclick="replyMessage(2)" title="YanÄ±tla">â†©ï¸</button>
                        <button class="btn-icon btn-delete" onclick="deleteMessage(2)" title="Sil">ğŸ—‘ï¸</button>
                    </div>
                </div>

                <!-- Message Item 3 -->
                <div class="message-item unread" data-id="3" onclick="openMessage(3)">
                    <div class="message-checkbox">
                        <input type="checkbox" class="message-check" data-id="3">
                    </div>
                    <div class="message-avatar">
                        <div class="avatar-circle">M</div>
                    </div>
                    <div class="message-content">
                        <div class="message-header">
                            <h4>Mehmet Kaya</h4>
                            <span class="message-time">2 gÃ¼n Ã¶nce</span>
                        </div>
                        <div class="message-subject">Hizmet Bilgisi</div>
                        <div class="message-preview">3D modelleme hizmetleriniz hakkÄ±nda bilgi almak istiyorum. Fiyat listesi var mÄ±?</div>
                        <div class="message-meta">
                            <span class="message-type service">Hizmet</span>
                        </div>
                    </div>
                    <div class="message-actions">
                        <button class="btn-icon btn-reply" onclick="replyMessage(3)" title="YanÄ±tla">â†©ï¸</button>
                        <button class="btn-icon btn-delete" onclick="deleteMessage(3)" title="Sil">ğŸ—‘ï¸</button>
                    </div>
                </div>

                <!-- Message Item 4 -->
                <div class="message-item read" data-id="4" onclick="openMessage(4)">
                    <div class="message-checkbox">
                        <input type="checkbox" class="message-check" data-id="4">
                    </div>
                    <div class="message-avatar">
                        <div class="avatar-circle">E</div>
                    </div>
                    <div class="message-content">
                        <div class="message-header">
                            <h4>Elif Demir</h4>
                            <span class="message-time">3 gÃ¼n Ã¶nce</span>
                        </div>
                        <div class="message-subject">Ä°ÅŸ BaÅŸvurusu</div>
                        <div class="message-preview">MimarlÄ±k ofisinizde Ã§alÄ±ÅŸmak istiyorum. CV'mi ekliyorum.</div>
                        <div class="message-meta">
                            <span class="message-type general">Genel</span>
                            <span class="message-status replied">YanÄ±tlandÄ±</span>
                        </div>
                    </div>
                    <div class="message-actions">
                        <button class="btn-icon btn-reply" onclick="replyMessage(4)" title="YanÄ±tla">â†©ï¸</button>
                        <button class="btn-icon btn-delete" onclick="deleteMessage(4)" title="Sil">ğŸ—‘ï¸</button>
                    </div>
                </div>

                <!-- Message Item 5 -->
                <div class="message-item unread" data-id="5" onclick="openMessage(5)">
                    <div class="message-checkbox">
                        <input type="checkbox" class="message-check" data-id="5">
                    </div>
                    <div class="message-avatar">
                        <div class="avatar-circle">C</div>
                    </div>
                    <div class="message-content">
                        <div class="message-header">
                            <h4>Can Ã–zkan</h4>
                            <span class="message-time">4 gÃ¼n Ã¶nce</span>
                        </div>
                        <div class="message-subject">Åikayet</div>
                        <div class="message-preview">Web sitenizde teknik bir sorun var. Ä°letiÅŸim formu Ã§alÄ±ÅŸmÄ±yor.</div>
                        <div class="message-meta">
                            <span class="message-type complaint">Åikayet</span>
                            <span class="message-priority">Ã–ncelikli</span>
                        </div>
                    </div>
                    <div class="message-actions">
                        <button class="btn-icon btn-reply" onclick="replyMessage(5)" title="YanÄ±tla">â†©ï¸</button>
                        <button class="btn-icon btn-delete" onclick="deleteMessage(5)" title="Sil">ğŸ—‘ï¸</button>
                    </div>
                </div>
            </div>

            <!-- Message Detail Panel -->
            <div class="message-detail" id="messageDetail" style="display: none;">
                <div class="message-detail-header">
                    <button class="btn btn-sm btn-secondary" onclick="closeMessageDetail()">â† Geri</button>
                    <div class="message-detail-actions">
                        <button class="btn btn-sm btn-primary" onclick="replyToCurrentMessage()">YanÄ±tla</button>
                        <button class="btn btn-sm btn-danger" onclick="deleteCurrentMessage()">Sil</button>
                    </div>
                </div>

                <div class="message-detail-content" id="messageDetailContent">
                    <!-- Message content will be loaded here -->
                </div>
            </div>
        </div>

        <!-- Bulk Actions -->
        <div class="bulk-actions" id="bulkActions" style="display: none;">
            <span class="bulk-info">SeÃ§ili mesajlar:</span>
            <button class="btn btn-sm btn-success" onclick="bulkAction('markRead')">Okundu Ä°ÅŸaretle</button>
            <button class="btn btn-sm btn-warning" onclick="bulkAction('markUnread')">OkunmamÄ±ÅŸ Ä°ÅŸaretle</button>
            <button class="btn btn-sm btn-danger" onclick="bulkAction('delete')">Sil</button>
        </div>
    </main>

    <!-- Reply Modal -->
    <div id="replyModal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Mesaj YanÄ±tla</h3>
                <button class="modal-close" onclick="closeReplyModal()">Ã—</button>
            </div>
            <form id="replyForm">
                <input type="hidden" id="replyToMessageId" name="messageId">
                
                <div class="form-group">
                    <label for="replyTo">Kime</label>
                    <input type="email" id="replyTo" name="replyTo" readonly>
                </div>
                
                <div class="form-group">
                    <label for="replySubject">Konu</label>
                    <input type="text" id="replySubject" name="replySubject" required>
                </div>
                
                <div class="form-group">
                    <label for="replyContent">Mesaj</label>
                    <textarea id="replyContent" name="replyContent" rows="8" required></textarea>
                </div>
                
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeReplyModal()">Ä°ptal</button>
                    <button type="submit" class="btn btn-primary">GÃ¶nder</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        let currentMessageId = null;

        // Sayfa yÃ¼klendiÄŸinde
        window.addEventListener('load', function() {
            checkAuth();
            loadUserInfo();
        });

        // KullanÄ±cÄ± giriÅŸi kontrolÃ¼
        function checkAuth() {
            const adminUser = localStorage.getItem('adminUser');
            if (!adminUser) {
                window.location.href = 'login.html';
                return;
            }
        }

        // KullanÄ±cÄ± bilgilerini yÃ¼kle
        function loadUserInfo() {
            const adminUser = localStorage.getItem('adminUser');
            if (adminUser) {
                const user = JSON.parse(adminUser);
                const initial = user.name ? user.name.charAt(0).toUpperCase() : 'A';
                document.getElementById('userAvatar').textContent = initial;
                document.getElementById('userName').textContent = user.name || 'Admin';
                document.getElementById('userRole').textContent = user.role || 'YÃ¶netici';
            }
        }

        // Mesaj aÃ§
        function openMessage(id) {
            currentMessageId = id;
            
            // Demo mesaj verisi
            const messageData = {
                id: id,
                sender: 'Ahmet YÄ±lmaz',
                email: 'ahmet@example.com',
                subject: 'Proje Teklifi HakkÄ±nda',
                content: `Merhaba,

Ofis binasÄ± projemiz iÃ§in mimari tasarÄ±m hizmeti almak istiyoruz. Proje detaylarÄ±:

- Konum: Ä°stanbul, ÅiÅŸli
- Alan: 2,500 mÂ²
- Kat sayÄ±sÄ±: 8 kat
- BÃ¼tÃ§e: â‚º 5,000,000

Bu konuda teklif alabilir miyiz? GÃ¶rÃ¼ÅŸme iÃ§in uygun zamanlarÄ±nÄ±zÄ± paylaÅŸabilir misiniz?

TeÅŸekkÃ¼rler,
Ahmet YÄ±lmaz`,
                date: '2025-01-15 14:30',
                type: 'project',
                priority: true
            };

            // Mesaj detayÄ±nÄ± gÃ¶ster
            const detailContent = document.getElementById('messageDetailContent');
            detailContent.innerHTML = `
                <div class="message-detail-meta">
                    <div class="message-detail-sender">
                        <strong>${messageData.sender}</strong>
                        <span>${messageData.email}</span>
                    </div>
                    <div class="message-detail-date">${messageData.date}</div>
                </div>
                <div class="message-detail-subject">${messageData.subject}</div>
                <div class="message-detail-body">${messageData.content.replace(/\n/g, '<br>')}</div>
            `;

            document.getElementById('messageDetail').style.display = 'block';
            
            // MesajÄ± okundu olarak iÅŸaretle
            const messageItem = document.querySelector(`[data-id="${id}"]`);
            messageItem.classList.remove('unread');
            messageItem.classList.add('read');
        }

        // Mesaj detayÄ±nÄ± kapat
        function closeMessageDetail() {
            document.getElementById('messageDetail').style.display = 'none';
            currentMessageId = null;
        }

        // Mesaj yanÄ±tla
        function replyMessage(id) {
            const messageItem = document.querySelector(`[data-id="${id}"]`);
            const senderName = messageItem.querySelector('h4').textContent;
            
            document.getElementById('replyToMessageId').value = id;
            document.getElementById('replyTo').value = senderName.toLowerCase().replace(' ', '.') + '@example.com';
            document.getElementById('replySubject').value = 'Re: ' + messageItem.querySelector('.message-subject').textContent;
            
            document.getElementById('replyModal').style.display = 'block';
        }

        // Mevcut mesaja yanÄ±tla
        function replyToCurrentMessage() {
            if (currentMessageId) {
                replyMessage(currentMessageId);
            }
        }

        // YanÄ±t modalÄ±nÄ± kapat
        function closeReplyModal() {
            document.getElementById('replyModal').style.display = 'none';
        }

        // YanÄ±t formu
        document.getElementById('replyForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const formData = new FormData(this);
            const messageId = formData.get('messageId');
            const replyTo = formData.get('replyTo');
            const subject = formData.get('replySubject');
            const content = formData.get('replyContent');
            
            if (!subject || !content) {
                showNotification('LÃ¼tfen tÃ¼m alanlarÄ± doldurun!', 'error');
                return;
            }
            
            showNotification('YanÄ±t gÃ¶nderildi!', 'success');
            closeReplyModal();
            
            // MesajÄ± yanÄ±tlandÄ± olarak iÅŸaretle
            const messageItem = document.querySelector(`[data-id="${messageId}"]`);
            const meta = messageItem.querySelector('.message-meta');
            if (!meta.querySelector('.message-status')) {
                meta.innerHTML += '<span class="message-status replied">YanÄ±tlandÄ±</span>';
            }
        });

        // Mesaj sil
        function deleteMessage(id) {
            if (confirm('Bu mesajÄ± silmek istediÄŸinize emin misiniz?')) {
                const messageItem = document.querySelector(`[data-id="${id}"]`);
                messageItem.remove();
                showNotification('Mesaj silindi!', 'success');
            }
        }

        // Mevcut mesajÄ± sil
        function deleteCurrentMessage() {
            if (currentMessageId) {
                deleteMessage(currentMessageId);
                closeMessageDetail();
            }
        }

        // TÃ¼mÃ¼nÃ¼ okundu iÅŸaretle
        function markAllAsRead() {
            const unreadMessages = document.querySelectorAll('.message-item.unread');
            unreadMessages.forEach(message => {
                message.classList.remove('unread');
                message.classList.add('read');
            });
            showNotification('TÃ¼m mesajlar okundu olarak iÅŸaretlendi!', 'success');
        }

        // MesajlarÄ± dÄ±ÅŸa aktar
        function exportMessages() {
            showNotification('Mesajlar dÄ±ÅŸa aktarÄ±lÄ±yor...', 'info');
        }

        // Toplu iÅŸlemler
        function bulkAction(action) {
            const checkedMessages = document.querySelectorAll('.message-check:checked');
            if (checkedMessages.length === 0) {
                showNotification('LÃ¼tfen en az bir mesaj seÃ§in!', 'error');
                return;
            }

            let message = '';
            switch(action) {
                case 'markRead':
                    checkedMessages.forEach(check => {
                        const messageItem = check.closest('.message-item');
                        messageItem.classList.remove('unread');
                        messageItem.classList.add('read');
                    });
                    message = 'SeÃ§ili mesajlar okundu olarak iÅŸaretlendi!';
                    break;
                case 'markUnread':
                    checkedMessages.forEach(check => {
                        const messageItem = check.closest('.message-item');
                        messageItem.classList.remove('read');
                        messageItem.classList.add('unread');
                    });
                    message = 'SeÃ§ili mesajlar okunmamÄ±ÅŸ olarak iÅŸaretlendi!';
                    break;
                case 'delete':
                    if (confirm('SeÃ§ili mesajlarÄ± silmek istediÄŸinize emin misiniz?')) {
                        checkedMessages.forEach(check => {
                            check.closest('.message-item').remove();
                        });
                        message = 'SeÃ§ili mesajlar silindi!';
                    } else {
                        return;
                    }
                    break;
            }

            showNotification(message, 'success');
            updateBulkActions();
        }

        // Toplu iÅŸlemler gÃ¼ncelle
        function updateBulkActions() {
            const checkedMessages = document.querySelectorAll('.message-check:checked');
            const bulkActions = document.getElementById('bulkActions');
            
            if (checkedMessages.length > 0) {
                bulkActions.style.display = 'block';
            } else {
                bulkActions.style.display = 'none';
            }
        }

        // Checkbox deÄŸiÅŸikliklerini dinle
        document.addEventListener('change', function(e) {
            if (e.target.classList.contains('message-check')) {
                updateBulkActions();
            }
        });

        // Arama fonksiyonu
        document.getElementById('searchInput').addEventListener('input', function(e) {
            const searchTerm = e.target.value.toLowerCase();
            const messages = document.querySelectorAll('.message-item');
            
            messages.forEach(message => {
                const sender = message.querySelector('h4').textContent.toLowerCase();
                const subject = message.querySelector('.message-subject').textContent.toLowerCase();
                const preview = message.querySelector('.message-preview').textContent.toLowerCase();
                
                if (sender.includes(searchTerm) || subject.includes(searchTerm) || preview.includes(searchTerm)) {
                    message.style.display = '';
                } else {
                    message.style.display = 'none';
                }
            });
        });

        // Ã‡Ä±kÄ±ÅŸ yap
        function logout() {
            if (confirm('Ã‡Ä±kÄ±ÅŸ yapmak istediÄŸinize emin misiniz?')) {
                localStorage.removeItem('adminUser');
                window.location.href = 'login.html';
            }
        }

        // Bildirim gÃ¶ster
        function showNotification(message, type) {
            const notification = document.createElement('div');
            notification.className = 'alert alert-' + type;
            notification.textContent = message;
            notification.style.position = 'fixed';
            notification.style.top = '20px';
            notification.style.right = '20px';
            notification.style.zIndex = '10000';
            notification.style.minWidth = '300px';
            notification.style.animation = 'fadeIn 0.3s ease-in';
            
            document.body.appendChild(notification);
            
            setTimeout(function() {
                notification.style.animation = 'fadeOut 0.3s ease-out';
                setTimeout(function() {
                    notification.remove();
                }, 300);
            }, 3000);
        }

        // Modal dÄ±ÅŸÄ±na tÄ±klandÄ±ÄŸÄ±nda kapat
        window.addEventListener('click', function(e) {
            const replyModal = document.getElementById('replyModal');
            if (e.target === replyModal) {
                closeReplyModal();
            }
        });
    </script>
</body>
</html>
